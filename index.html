<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0"
    >
    <title>派车单管理系统</title>
    <link
        rel="stylesheet"
        href="style/common.css"
    >
    <link
        rel="stylesheet"
        href="style/card-styles.css"
    >

    <link
        rel="preload"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
        as="style"
        onload="this.onload=null;this.rel='stylesheet'"
     >
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"></noscript>
    <link rel="stylesheet" href="style/pdf-styles.css">

</head>

<body>
    <!-- 顶部导航栏 -->
    <template id="GHOST_TEMPLATE">
        <nav class="topbar">
            <div class="logo">
                <img
                    id="company-logo"
                    alt="公司logo"
                />
            </div>
            <div class="nav-links">
                <a href="#" class="active">货运管理</a>
                <a href="#">DIY路线</a>
                <a href="#">线路管理</a>
                <a href="#">客户列表</a>
            </div>
            <div class="search-box">
                <input
                    type="text"
                    placeholder="搜索..."
                />
                <i class="fas fa-search"></i>
            </div>
        </nav>
        <!-- 主要内容区域 -->
        <div class="container">
            <!-- 侧边栏导航 -->
            <nav class="sidebar">
                <div class="sidebar-section">
                    <h3>货运管理</h3>
                    <a
                        href="#"
                        class="nav-item active"
                    ><i class="fas fa-tachometer-alt"></i>总览</a>
                    <a
                        href="#"
                        class="nav-item"
                    ><i class="fas fa-list"></i>订单管理</a>
                </div>
                <div class="sidebar-section">
                    <h3>派车管理</h3>
                    <a
                        href="#"
                        class="nav-item"
                    ><i class="fas fa-plus"></i>创建派车单</a>
                    <a
                        href="#"
                        class="nav-item"
                    ><i class="fas fa-history"></i>历史派车单</a>
                </div>
            </nav>
            <!-- 总览页面 -->
            <div
                id="overview-dashboard"
                class="dashboard-content"
            >
                <div class="section-card-header">
                    <h2>系统总览</h2>
                </div>
                <div class="overview-cards">
                    <div class="overview-card" onclick="showOverviewOrdersByType('inTransit')">
                        <div class="card-icon"><i class="fas fa-truck"></i></div>
                        <div class="card-content">
                            <h3>运输中订单</h3>
                            <p class="card-value" id="inTransitOrdersCount">0</p>
                        </div>
                    </div>
                    <div class="overview-card" onclick="showOverviewOrdersByType('completed')">
                        <div class="card-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="card-content">
                            <h3>已完成订单</h3>
                            <p class="card-value" id="completedOrdersCount">0</p>
                        </div>
                    </div>
                    <div class="overview-card" onclick="showOverviewOrdersByType('monthly')">
                        <div class="card-icon"><i class="fas fa-calendar-alt"></i></div>
                        <div class="card-content">
                            <h3>本月订单</h3>
                            <p class="card-value" id="monthlyOrdersCount">0</p>
                        </div>
                    </div>
                    <div class="overview-card" onclick="showOverviewOrdersByType('prepareDispatch')" style="background: linear-gradient(135deg, #ff9800, #f57c00); color: white;">
                        <div class="card-icon"><i class="fas fa-clock"></i></div>
                        <div class="card-content">
                            <h3>准备派车</h3>
                            <p class="card-value" id="prepareDispatchCount">0</p>
                        </div>
                    </div>

                </div>


                <!-- 总览页面订单表格区域 -->
                <div id="overview-orders-section" class="overview-orders-section" style="display: none;">
                    <div class="section-card-header">
                        <h3 id="overview-orders-title">订单列表</h3>
                        <button class="btn btn-sm btn-outline" onclick="hideOverviewOrders()">
                            <i class="fas fa-times"></i> 关闭
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="order-table">
                            <thead>
                                <tr>
                                    <th width="40px">
                                        <input type="checkbox" id="selectAllOverviewOrders" onchange="toggleSelectAll('overviewOrder')">
                                    </th>
                                    <th>订单号</th>
                                    <th>路线</th>
                                    <th class="pickup-group">提货工厂</th>
                                    <th class="delivery-group">送货工厂</th>
                                    <th class="time-group">提货时间</th>
                                    <th class="time-group">送货时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="overviewOrderTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 订单管理 -->
            <div
                id="order-management"
                class="dashboard-content"
                style="display: none;"
            >
                <div class="section-card-header">
                    <h2>订单管理</h2>
                    <div class="batch-operations">
                        <button class="btn btn-sm btn-outline" id="toggleSelectAllOrdersBtn">
                            <i class="fas fa-check-square"></i> 全选/取消
                        </button>
                        <button class="btn btn-sm btn-danger" id="batchDeleteOrdersBtn" disabled>
                            <i class="fas fa-trash"></i> 批量删除
                        </button>
                        <button class="btn btn-sm btn-success" id="batchPrintOrdersBtn" disabled>
                            <i class="fas fa-print"></i> 批量打印
                        </button>
                        <button class="btn btn-sm btn-info" id="exportOrdersBtn" disabled>
                            <i class="fas fa-download"></i> 导出选中
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="order-table">
                        <thead>
                            <tr>
                                <th width="40px">
                                    <input type="checkbox" id="selectAllOrders">
                                </th>
                                <th>订单号</th>
                                <th>路线</th>
                                <th class="pickup-group">提货工厂</th>
                                <th class="delivery-group">送货工厂</th>
                                <th class="time-group">提货时间</th>
                                <th class="time-group">送货时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="orderTable"></tbody>
                    </table>
                </div>
            </div>
            <!-- 派车单表单 -->
            <div
                id="dispatch-form"
                class="dashboard-content"
                style="display: none;"
            >
                <div class="section-card-header">
                    <h2><i class="fas fa-truck"></i> 创建派车单</h2>
                </div>
                <div class="form-container enhanced-form">
                    <!-- 基本信息卡片 -->
                    <div class="form-card">
                        <div class="card-header">
                            <h3><i class="fas fa-info-circle"></i> 基本信息</h3>
                        </div>
                        <div class="form-group">
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="po"><i class="fas fa-file-alt"></i> Shipment</label>
                                    <input
                                        type="text"
                                        id="po"
                                        class="form-control"
                                        placeholder="请输入Shipment"
                                    >
                                </div>
                                <div class="form-col">
                                    <label for="cw1no"><i class="fas fa-barcode"></i> PO</label>
                                    <input
                                        type="text"
                                        id="cw1no"
                                        class="form-control"
                                        placeholder="请输入PO"
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 车队和路线信息卡片 -->
                    <div class="form-card">
                        <div class="card-header">
                            <h3><i class="fas fa-users"></i> 车队与路线</h3>
                        </div>
                        <div class="form-group">
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="transportTeam"><i class="fas fa-truck"></i> TO车队 <span style="color: red;">*</span></label>
                                    <div class="input-group">
                                        <select id="transportTeam" class="form-control" required>
                                            <option value="">请选择TO车队</option>
                                            <option value="车队A">车队A</option>
                                            <option value="车队B">车队B</option>
                                            <option value="车队C">车队C</option>
                                        </select>
                                        <div class="input-group-append">
                                            <button type="button" class="btn btn-sm btn-outline" onclick="openTransportTeamModal()" title="新增车队">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline" onclick="openTeamManageModal()" title="管理车队">
                                                <i class="fas fa-cog"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <label for="vehicleType"><i class="fas fa-car"></i> 车型 <span style="color: red;">*</span></label>
                                    <input
                                        type="text"
                                        id="vehicleType"
                                        class="form-control"
                                        placeholder="请输入车型"
                                        required
                                    >
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="route"><i class="fas fa-route"></i> 选择路线</label>
                                    <div class="route-selection-container">
                                        <!-- 下拉选择框 -->
                                        <select
                                            id="route"
                                            class="form-control"
                                            onchange="fillRouteInfo()"
                                        >
                                            <option value="">请选择路线</option>
                                        </select>

                                        <!-- 搜索功能切换按钮 -->
                                        <button
                                            type="button"
                                            id="toggleSearchBtn"
                                            class="btn btn-sm btn-outline"
                                            onclick="toggleRouteSearchMode()"
                                            title="切换到搜索模式"
                                        >
                                            <i class="fas fa-search"></i>
                                        </button>

                                        <!-- 搜索容器（默认隐藏） -->
                                        <div class="route-search-container" id="routeSearchContainer" style="display: none;">
                                            <input
                                                type="text"
                                                id="routeSearch"
                                                class="form-control"
                                                placeholder="搜索路线名称..."
                                                oninput="searchAndDisplayRoutes()"
                                                onfocus="showRouteDropdown()"
                                                onblur="hideRouteDropdown()"
                                            >
                                            <div id="routeDropdown" class="route-dropdown" style="display: none;">
                                                <div class="route-dropdown-content">
                                                    <!-- 路线选项将在这里动态生成 -->
                                                </div>
                                            </div>
                                        </div>

                                        <input type="hidden" id="selectedRouteId" value="">
                                    </div>

                                    <div class="button-group">
                                        <button
                                            type="button"
                                            class="btn btn-sm btn-accent"
                                            onclick="openRouteManagement()"
                                        >
                                            <i class="fas fa-cog"></i> 管理路线 </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 提货信息卡片 -->
                    <div class="form-card">
                        <div class="card-header">
                            <h3><i class="fas fa-arrow-up"></i> 提货信息</h3>
                            <div class="button-group">
                                <button type="button" class="btn btn-sm btn-outline" onclick="showCustomerListModal('pickup')">
                                    <i class="fas fa-users"></i> 从客户列表选择
                                </button>
                                <button type="button" class="btn btn-sm btn-accent add-pickup-point" onclick="addPickupPoint()">
                                    <i class="fas fa-plus"></i> 增加提货点
                                </button>
                            </div>
                        </div>
                        <div class="form-group" id="pickupPointsContainer">
                            <div class="pickup-point-container">
                                <div class="point-remove" onclick="removePickupPoint(this)">×</div>
                                <div class="form-row pickup-point" data-point-index="0">
                                    <div class="form-col">
                                        <label for="pickupFactory"><i class="fas fa-industry"></i> 名称</label>
                                        <input
                                            type="text"
                                            id="pickupFactory"
                                            class="form-control"
                                            placeholder="请输入提货工厂名称"
                                        >
                                    </div>
                                    <div class="form-col">
                                        <label for="pickupContact"><i class="fas fa-user"></i> 联系人</label>
                                        <input
                                            type="text"
                                            id="pickupContact"
                                            class="form-control"
                                            placeholder="请输入联系人姓名"
                                        >
                                    </div>
                                    <div class="form-col">
                                        <label for="pickupDate"><i class="fas fa-calendar"></i> 提货日期</label>
                                        <input type="date" id="pickupDate" class="form-control" onchange="validateDateRange()">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-col full-width">
                                        <label for="pickupAddress"><i class="fas fa-map-marker-alt"></i> 提货地址</label>
                                        <input
                                            type="text"
                                            id="pickupAddress"
                                            class="form-control"
                                            placeholder="请输入提货地址"
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 物流园信息卡片 -->
                    <div class="form-card">
                        <div class="card-header">
                            <h3><i class="fas fa-warehouse"></i> 物流园信息</h3>
                            <button type="button" class="btn btn-sm btn-outline" onclick="showCustomerListModal('logistics')">
                                <i class="fas fa-users"></i> 从客户列表选择
                            </button>
                        </div>
                        <div class="form-group">
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="parkName"><i class="fas fa-building"></i> 名称</label>
                                    <input
                                        type="text"
                                        id="parkName"
                                        class="form-control"
                                        placeholder="请输入物流园名称"
                                    >
                                </div>
                                <div class="form-col">
                                    <label for="parkContact"><i class="fas fa-user"></i> 联系人</label>
                                    <input
                                        type="text"
                                        id="parkContact"
                                        class="form-control"
                                        placeholder="请输入联系人姓名"
                                    >
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="parkAddress"><i class="fas fa-map-marker-alt"></i> 地址</label>
                                    <input
                                        type="text"
                                        id="parkAddress"
                                        class="form-control"
                                        placeholder="请输入物流园详细地址"
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 送货信息卡片 -->
                    <div class="form-card">
                        <div class="card-header">
                            <h3><i class="fas fa-arrow-down"></i> 送货信息</h3>
                            <div class="button-group">
                                <button type="button" class="btn btn-sm btn-outline" onclick="showCustomerListModal('delivery')">
                                    <i class="fas fa-users"></i> 从客户列表选择
                                </button>
                                <button type="button" class="btn btn-sm btn-accent add-delivery-point" onclick="addDeliveryPoint()">
                                    <i class="fas fa-plus"></i> 增加送货点
                                </button>
                            </div>
                        </div>
                        <div class="form-group" id="deliveryPointsContainer">
                            <div class="delivery-point-container">
                                <div class="point-remove" onclick="removeDeliveryPoint(this)">×</div>
                                <div class="form-row delivery-point" data-point-index="0">
                                    <div class="form-col">
                                        <label for="deliveryFactory"><i class="fas fa-industry"></i> 名称</label>
                                        <input
                                            type="text"
                                            id="deliveryFactory"
                                            class="form-control"
                                            placeholder="请输入送货工厂名称"
                                        >
                                    </div>
                                    <div class="form-col">
                                        <label for="deliveryContact"><i class="fas fa-user"></i> 联系人</label>
                                        <input
                                            type="text"
                                            id="deliveryContact"
                                            class="form-control"
                                            placeholder="请输入联系人姓名"
                                        >
                                    </div>
                                    <div class="form-col">
                                        <label for="deliveryDate"><i class="fas fa-calendar"></i> 送货日期</label>
                                        <input type="date" id="deliveryDate" class="form-control" onchange="validateDateRange()">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-col full-width">
                                        <label for="deliveryAddress"><i class="fas fa-map-marker-alt"></i> 送货地址</label>
                                        <input
                                            type="text"
                                            id="deliveryAddress"
                                            class="form-control"
                                            placeholder="请输入送货地址"
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 货物信息卡片 -->
                    <div class="form-card">
                        <div class="card-header">
                            <h3><i class="fas fa-boxes"></i> 货物信息</h3>
                        </div>
                        <div class="form-group">
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="cargoType"><i class="fas fa-tag"></i> 货物类型</label>
                                    <input
                                        type="text"
                                        id="cargoType"
                                        class="form-control"
                                        placeholder="请输入货物类型"
                                    >
                                </div>
                                <div class="form-col">
                                    <label for="cargoWeight"><i class="fas fa-weight-hanging"></i> 重量 (KG)</label>
                                    <input
                                        type="number"
                                        id="cargoWeight"
                                        class="form-control"
                                        step="0.01"
                                        placeholder="0.00"
                                    >
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="cargoVolume"><i class="fas fa-cube"></i> 体积 (m³)</label>
                                    <input
                                        type="number"
                                        id="cargoVolume"
                                        class="form-control"
                                        step="0.01"
                                        placeholder="0.00"
                                    >
                                </div>
                                <div class="form-col">
                                    <label for="cargoPieces"><i class="fas fa-layer-group"></i> 件数</label>
                                    <input
                                        type="text"
                                        id="cargoPieces"
                                        class="form-control"
                                        placeholder="请输入件数"
                                    >
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col full-width">
                                    <label for="cargoNotes"><i class="fas fa-sticky-note"></i> 备注</label>
                                    <textarea
                                        id="cargoNotes"
                                        class="form-control"
                                        rows="3"
                                        placeholder="请输入货物相关备注信息..."
                                    ></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 操作按钮 -->
                    <div class="form-actions enhanced-actions">
                        <button
                            type="button"
                            class="btn btn-large btn-accent"
                            onclick="generateDispatchSheet()"
                        >
                            <i class="fas fa-file-export"></i> 生成并保存派车单 </button>

                        <button
                            type="button"
                            class="btn btn-large btn-secondary"
                            onclick="clearDispatchForm()"
                        >
                            <i class="fas fa-eraser"></i> 清空表单 </button>
                    </div>
                </div>
            </div>
            <!-- DIY路线页面 -->
            <div
                id="diy-route"
                class="dashboard-content"
                style="display: none;"
            >
                <div class="section-card-header">
                    <h2><i class="fas fa-route"></i> DIY路线规划</h2>
                </div>
                <div class="form-container enhanced-form">
                    <!-- 路线基本信息卡片 -->
                    <div class="form-card">
                        <div class="card-header">
                            <h3><i class="fas fa-info-circle"></i> 路线基本信息</h3>
                        </div>
                        <div class="form-group">
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="routeName"><i class="fas fa-tag"></i> 路线名称 <span class="required">*</span></label>
                                    <input
                                        type="text"
                                        id="routeName"
                                        class="form-control"
                                        required
                                        placeholder="请输入路线名称"
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 路线设置卡片 -->
                    <div class="form-card">
                        <div class="card-header">
                            <h3><i class="fas fa-route"></i> 路线</h3>
                            <div class="waypoint-actions">
                                <button type="button" class="btn btn-sm btn-accent" onclick="addWaypoint()">
                                    <i class="fas fa-plus"></i> 添加途经点
                                </button>
                                <button type="button" class="btn btn-sm btn-outline" onclick="showCustomerListModal('waypoint')">
                                    <i class="fas fa-users"></i> 从客户列表添加
                                </button>
                            </div>
                        </div>
                        <div id="waypointsContainer" class="waypoints-container">
                            <!-- 动态添加的途经点将在这里显示 -->
                        </div>
                    </div>

                    <!-- 货物信息卡片 -->
                    <div class="form-card">
                        <div class="card-header">
                            <h3><i class="fas fa-boxes"></i> 货物信息</h3>
                        </div>
                        <div class="form-group">
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="routeCargoType"><i class="fas fa-tag"></i> 货物类型</label>
                                    <input
                                        type="text"
                                        id="routeCargoType"
                                        class="form-control"
                                        placeholder="请输入货物类型"
                                    >
                                </div>
                                <div class="form-col">
                                    <label for="routeCargoWeight"><i class="fas fa-weight-hanging"></i> 重量 (吨)</label>
                                    <input
                                        type="number"
                                        id="routeCargoWeight"
                                        class="form-control"
                                        step="0.01"
                                        placeholder="0.00"
                                    >
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="routeCargoVolume"><i class="fas fa-cube"></i> 体积 (m³)</label>
                                    <input
                                        type="number"
                                        id="routeCargoVolume"
                                        class="form-control"
                                        step="0.01"
                                        placeholder="0.00"
                                    >
                                </div>
                                <div class="form-col">
                                    <label for="routeCargoPieces"><i class="fas fa-layer-group"></i> 件数</label>
                                    <input
                                        type="number"
                                        id="routeCargoPieces"
                                        class="form-control"
                                        placeholder="0"
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 备注信息卡片 -->
                    <div class="form-card">
                        <div class="card-header">
                            <h3><i class="fas fa-sticky-note"></i> 路线备注</h3>
                        </div>
                        <div class="form-group">
                            <div class="form-row">
                                <div class="form-col full-width">
                                    <label for="routeNotes"><i class="fas fa-comment"></i> 备注信息</label>
                                    <textarea
                                        id="routeNotes"
                                        class="form-control"
                                        rows="4"
                                        placeholder="请输入路线相关备注信息，如特殊要求、注意事项等..."
                                    ></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 操作按钮 -->
                    <div class="form-actions enhanced-actions">
                        <button
                            type="button"
                            class="btn btn-large btn-accent"
                            onclick="saveRoute()"
                        >
                            <i class="fas fa-save"></i> 保存路线
                        </button>
                        <button
                            type="button"
                            class="btn btn-large btn-outline"
                            onclick="previewRoute()"
                        >
                            <i class="fas fa-eye"></i> 预览路线
                        </button>
                        <button
                            type="button"
                            class="btn btn-large btn-secondary"
                            onclick="clearRouteForm()"
                        >
                            <i class="fas fa-eraser"></i> 清空表单
                        </button>
                    </div>
                </div>
            </div>
            <!-- 客户列表 -->
            <div
                id="customer-list"
                class="dashboard-content"
                style="display: none;"
            >
                <!-- 页面头部 -->
                <div class="page-header">
                    <div class="page-title-section">
                        <h2><i class="fas fa-users"></i> 客户管理</h2>
                        <p class="page-subtitle">管理和维护客户信息，支持快速搜索和批量操作</p>
                    </div>
                    <div class="page-actions">
                        <button class="btn btn-sm btn-outline" onclick="toggleCustomerSelectAll()">
                            <i class="fas fa-check-square"></i> 全选/取消
                        </button>
                        <button class="btn btn-sm btn-danger customer-batch-btn" onclick="batchDeleteCustomers()" id="batchDeleteCustomersBtn" disabled>
                            <i class="fas fa-trash"></i> 批量删除
                        </button>
                        <button class="btn btn-sm btn-info customer-batch-btn" onclick="exportSelectedCustomers()" id="exportCustomersBtn" disabled>
                            <i class="fas fa-download"></i> 导出选中
                        </button>
                        <button class="btn btn-sm btn-warning" onclick="importCustomerData()">
                            <i class="fas fa-upload"></i> 导入数据
                        </button>
                        <button
                            class="btn btn-accent btn-large"
                            onclick="openCustomerModal()"
                        >
                            <i class="fas fa-plus"></i> 新增客户 </button>
                    </div>
                </div>
                <!-- 客户列表主体 -->
                <div class="customer-management-container">
                    <!-- 搜索和筛选工具栏 -->
                    <div class="toolbar-section">
                        <div class="search-section">
                            <div class="search-input-group">
                                <i class="fas fa-search search-icon"></i>
                                <input
                                    type="text"
                                    id="customerSearch"
                                    placeholder="搜索客户名称、联系人或电话..."
                                    class="search-input"
                                >
                                <button
                                    class="search-clear-btn"
                                    onclick="clearCustomerSearch()"
                                    style="display: none;"
                                >
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>

                    </div>
                    <!-- 表格视图 -->
                    <div
                        id="customerTableView"
                        class="table-view-container"
                    >
                        <div class="enhanced-table-container">
                            <table class="enhanced-customer-table">
                                <thead>
                                    <tr>
                                        <th width="40px">
                                            <input type="checkbox" id="customerSelectAll" onchange="toggleCustomerSelectAll()">
                                        </th>
                                        <th>名称</th>
                                        <th>联系人</th>
                                        <th>联系电话</th>
                                        <th>地址</th>
                                        <th class="actions-column">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="customerTableBody">
                                    <!-- 客户数据将通过JavaScript动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>


                    <!-- 分页控制 -->
                    <div class="enhanced-pagination-container">
                        <div class="pagination-info-section">
                            <span
                                id="customerPaginationInfo"
                                class="pagination-info"
                            >显示 1-10 条，共 0 条记录</span>
                        </div>
                        <div class="pagination-controls">
                            <button
                                id="customerFirstPage"
                                class="btn btn-outline btn-sm"
                                onclick="goToCustomerPage()"
                                disabled
                            >
                                <i class="fas fa-angle-double-left"></i>
                            </button>
                            <button
                                id="customerPrevPage"
                                class="btn btn-outline btn-sm"
                                onclick="changeCustomerPage()"
                                disabled
                            >
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div
                                class="page-numbers"
                                id="customerPageNumbers"
                            >
                                <!-- 页码按钮将动态生成 -->
                            </div>
                            <button
                                id="customerNextPage"
                                class="btn btn-outline btn-sm"
                                onclick="changeCustomerPage()"
                                disabled
                            >
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button
                                id="customerLastPage"
                                class="btn btn-outline btn-sm"
                                onclick="goToCustomerLastPage()"
                                disabled
                            >
                                <i class="fas fa-angle-double-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 客户详情模态框 -->
            <div
                id="customerDetailsModal"
                class="modal"
            >
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>客户详情</h3>
                        <span
                            class="close"
                            onclick="closeCustomerDetails()"
                        >&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="customer-details">
                            <div class="detail-row">
                                <label>名称：</label>
                                <span id="detailCustomerName"></span>
                            </div>
                            <div class="detail-row">
                                <label>地址：</label>
                                <span id="detailCustomerAddress"></span>
                            </div>
                            <div class="detail-row">
                                <label>联系人：</label>
                                <span id="detailCustomerContact"></span>
                            </div>
                            <div class="detail-row">
                                <label>联系电话：</label>
                                <span id="detailCustomerPhone"></span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-primary"
                            onclick="editCustomer()"
                        >编辑</button>
                        <button
                            type="button"
                            class="btn btn-secondary"
                            onclick="closeCustomerDetails()"
                        >关闭</button>
                    </div>
                </div>
            </div>

            <!-- 导入预览模态框 -->
            <div id="importPreviewModal" class="modal import-preview-modal">
                <div class="modal-content import-preview-content">
                    <div class="modal-header">
                        <h3>📊 导入数据预览</h3>
                        <span class="close" onclick="closeImportPreview()">&times;</span>
                    </div>
                    <div class="import-preview-container">
                        <div class="import-summary">
                            <div class="summary-item success">
                                <span>✅</span>
                                <div>
                                    <div>有效数据</div>
                                    <div id="validCount">0</div>
                                </div>
                            </div>
                            <div class="summary-item error">
                                <span>❌</span>
                                <div>
                                    <div>无效数据</div>
                                    <div id="invalidCount">0</div>
                                </div>
                            </div>
                        </div>

                        <div id="validDataSection" class="preview-section">
                            <h4>✅ 有效数据 (将被导入)</h4>
                            <div class="preview-table-container">
                                <table class="preview-table">
                                    <thead>
                                        <tr>
                                            <th>客户名称</th>
                                            <th>联系人</th>
                                            <th>电话</th>
                                            <th>地址</th>
                                            <th>备注</th>
                                        </tr>
                                    </thead>
                                    <tbody id="validDataBody">
                                        <!-- 有效数据将在这里显示 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="invalidDataSection" class="preview-section error-section" style="display: none;">
                            <h4>❌ 无效数据 (将被跳过)</h4>
                            <div class="error-list" id="invalidDataList">
                                <!-- 无效数据将在这里显示 -->
                            </div>
                        </div>

                        <div class="import-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeImportPreview()">取消</button>
                            <button type="button" class="btn btn-primary" onclick="confirmImport()" id="confirmImportBtn">确认导入</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 新增客户模态框 -->
            <div
                id="customerModal"
                class="modal"
            >
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>新增客户</h2>
                        <button
                            class="close-btn"
                            onclick="closeCustomerModal()"
                        >&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="customerName">名称</label>
                            <input
                                type="text"
                                id="customerName"
                                class="form-control"
                                required
                            >
                        </div>
                        <div class="form-group">
                            <label for="customerAddress">地址</label>
                            <input
                                type="text"
                                id="customerAddress"
                                class="form-control"
                            >
                        </div>
                        <div class="form-group">
                            <label for="contactName">联系人</label>
                            <input
                                type="text"
                                id="contactName"
                                class="form-control"
                                required
                            >
                        </div>
                        <div class="form-group">
                            <label for="contactPhone">联系电话</label>
                            <input
                                type="tel"
                                id="contactPhone"
                                class="form-control"
                                required
                            >
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button
                            class="btn btn-accent"
                            onclick="saveCustomer()"
                        >保存</button>
                        <button
                            class="btn btn-outline"
                            onclick="closeCustomerModal()"
                        >取消</button>
                    </div>
                </div>
            </div>


        </div>
        <!-- 新增车队模态框 -->
        <div
            id="transportTeamModal"
            class="modal"
        >
            <div class="modal-content">
                <div class="modal-header">
                    <h2>新增车队</h2>
                    <button
                        class="close-btn"
                        onclick="closeTransportTeamModal()"
                    >&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="teamName">车队名称</label>
                        <input
                            type="text"
                            id="teamName"
                            class="form-control"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label for="teamContact">联系人</label>
                        <input
                            type="text"
                            id="teamContact"
                            class="form-control"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label for="teamPhone">联系电话</label>
                        <input
                            type="tel"
                            id="teamPhone"
                            class="form-control"
                            required
                        >
                    </div>
                </div>
                <div class="modal-footer">
                    <button
                        class="btn btn-accent"
                        onclick="saveTransportTeam()"
                    >保存</button>
                    <button
                        class="btn btn-outline"
                        onclick="closeTransportTeamModal()"
                    >取消</button>
                </div>
            </div>
        </div>
        <!-- 车队管理模态框 -->
        <div
            id="teamManageModal"
            class="modal"
        >
            <div class="modal-content">
                <div class="modal-header">
                    <h2>车队管理</h2>
                    <button
                        class="close-btn"
                        onclick="closeTeamManageModal()"
                    >&times;</button>
                </div>
                <div class="modal-body">
                    <table class="team-table">
                        <thead>
                            <tr>
                                <th>车队名称</th>
                                <th>联系人</th>
                                <th>联系电话</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="teamTable"></tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button
                        class="btn btn-outline"
                        onclick="closeTeamManageModal()"
                    >关闭</button>
                </div>
            </div>
        </div>

        <!-- 客户选择模态框 -->
        <div id="customerSelectionModal" class="modal">
            <div class="modal-content customer-selection-modal">
                <div class="modal-header">
                    <h2><i class="fas fa-users"></i> 选择客户</h2>
                    <button class="close-btn" onclick="closeCustomerSelectionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="customer-search-container">
                        <div class="search-input-group">
                            <i class="fas fa-search search-icon"></i>
                            <input
                                type="text"
                                id="customerSelectionSearch"
                                placeholder="搜索客户名称、联系人或电话..."
                                class="search-input"
                                oninput="filterCustomerSelection()"
                            >
                        </div>
                    </div>
                    <div id="customerSelectionList" class="customer-selection-list">
                        <!-- 客户列表将在这里动态生成 -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" onclick="closeCustomerSelectionModal()">取消</button>
                </div>
            </div>
        </div>
    </template>

    <div id="app"></div>
    <!-- 主要脚本 - 优先加载 -->
    <script src="js/index.js"></script>

    <!-- 延迟加载外部资源 -->
    <script>
        // 异步加载外部库
        function loadExternalLibraries() {
            const libraries = [
                'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js',
                'https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js',
                'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js'
            ];

            libraries.forEach((src, index) => {
                const script = document.createElement('script');
                script.src = src;
                script.async = true;
                if (index === 1) { // jsPDF
                    script.onload = () => {
                        if (typeof window.jspdf !== 'undefined') {
                            window.jsPDF = window.jspdf.jsPDF;
                        }
                    };
                }
                document.head.appendChild(script);
            });
        }

        // 页面加载完成后再加载外部库
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(loadExternalLibraries, 100);
            });
        } else {
            setTimeout(loadExternalLibraries, 100);
        }
    </script>

    <!-- 可选的动态网页核心文件 - 异步加载 -->
    <script>
        // 异步加载可选模块
        function loadOptionalModules() {
            const optionalModules = [
                // 'js/modules/firebase.js',
                // 'js/modules/api.js'
            ];

            optionalModules.forEach(src => {
                const script = document.createElement('script');
                script.src = src;
                script.async = true;
                script.onerror = () => console.log(`可选模块 ${src} 加载失败，继续使用本地功能`);
                document.head.appendChild(script);
            });
        }

        // 延迟加载可选模块
        setTimeout(loadOptionalModules, 200);
    </script>

    <script>
        // 初始化动态网页功能
        document.addEventListener('DOMContentLoaded', function() {
            // 检查网络连接状态
            function updateConnectionStatus() {
                const isOnline = navigator.onLine;
                console.log('网络状态:', isOnline ? '在线' : '离线');

                // 在页面顶部显示连接状态
                let statusElement = document.getElementById('connection-status');
                if (!statusElement) {
                    statusElement = document.createElement('div');
                    statusElement.id = 'connection-status';
                    statusElement.style.cssText = `
                        position: fixed;
                        top: 0;
                        right: 20px;
                        z-index: 10000;
                        padding: 5px 10px;
                        border-radius: 0 0 5px 5px;
                        font-size: 12px;
                        font-weight: bold;
                    `;
                    document.body.appendChild(statusElement);
                }

                statusElement.textContent = isOnline ? '在线模式' : '离线模式';
                statusElement.style.backgroundColor = isOnline ? '#4CAF50' : '#f44336';
                statusElement.style.color = 'white';
            }

            // 监听网络状态变化
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);

            // 初始化连接状态
            updateConnectionStatus();

            // 初始化API服务
            if (window.API) {
                window.API.init().then(() => {
                    console.log('动态网页功能已启用');
                    updateConnectionStatus();
                }).catch(error => {
                    console.warn('动态功能初始化失败，使用本地存储模式:', error);
                    updateConnectionStatus();
                });
            }
        });
    </script>
</body>

</html>